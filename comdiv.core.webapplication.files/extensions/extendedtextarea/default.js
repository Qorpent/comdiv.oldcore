var zeta = (undefined != zeta) ? zeta : {};zeta.extendedtextarea = (undefined != zeta.extendedtextarea) ? zeta.extendedtextarea : {};Object.extend(zeta.extendedtextarea, {    init: function(){        $$('textarea.extended').each(function(e){            zeta.extendedtextarea.textarea_create(e);        });    },        textarea_create: function(e){		e = $(e);        var toolbar = new Element('div', {            'class': 'textarea-toolbar'        });        var div = new Element('div', { 'class': 'textarea-container', 'id': 'textarea-container' + e.readAttribute('id') });        var numbers = new Element('textarea', { 'class': 'numeration' });                numbers.style.height = e.getHeight() - 3;        numbers.writeAttribute('readonly', '');        numbers.update('1');                div.style.overflow = 'hidden';        div.appendChild(numbers);        var e2 = e;		numbers.style.fontSize = e2.style.fontSize;        e2.style.marginLeft = '2px';        e2.writeAttribute('wrap', 'off');        e2.numbers = numbers;        Event.observe(e2, 'keyup', (function(e){            this.reloadlines(e2);        }).bind(this));                Event.observe(e2, 'keydown', (function(e){            if (e.keyCode == Event.KEY_TAB) {                var startPos = e2.selectionStart;                var endPos = e2.selectionEnd;                e2.value = e2.value.substring(0, startPos) +                "\t" +                e2.value.substring(endPos, e2.value.length);                e2.setSelectionRange(startPos + 1, startPos + 1);                Event.stop(e);            }        }).bind(this));		e2.extenddiv = div;		e2.toolbar = toolbar;		e2.numbers = numbers;        div.appendChild(toolbar);        Element.wrap(e2,div);		this.reloadlines(e2);		div.relativize();		div.style.width = e2.getWidth() + 'px';		div.style.height = e2.getHeight() + 'px';				var button1 = new Element('div', { 'class': 'textarea-toolbar-button', 'title': 'Размер шрифта -' });		var button2 = new Element('div', { 'class': 'textarea-toolbar-button', 'title': 'Размер шрифта +' });		button1.addClassName('decsize');		button2.addClassName('incsize');		toolbar.appendChild(button1);        toolbar.appendChild(button2);		Event.observe(button1, 'click', (function(){    		this.fontresize(e2, false);		}).bind(this));		Event.observe(button2, 'click', (function(){    		this.fontresize(e2, true);		}).bind(this));    },        reloadlines: function(textarea){        var textAreaStrings = textarea.value.split(/\r?\n/);        var textAreaRows = textAreaStrings.length;        var textAreaNumbersLines = textarea.numbers.value.split(/\r?\n/);        var textAreaNumbersLength = textAreaNumbersLines.length;        if (textAreaNumbersLength != textAreaRows) {            if (textAreaNumbersLength > textAreaRows) {                textAreaNumbersLines.splice(textAreaRows, textAreaNumbersLength - textAreaRows);            }            while (textAreaNumbersLength++ < textAreaRows) {                textAreaNumbersLines.push(textAreaNumbersLength);            }            textarea.numbers.value = textAreaNumbersLines.join("\r\n");        }        textarea.numbers.scrollTop = textarea.scrollTop;    },		fontresize : function(element, incr) {		delta = 3;		if(!incr) delta = -3;		fss = element.getStyle('font-size');		size = parseInt(fss) + delta;		type = fss.match(/\D+$/);		element.style.fontSize = size+type;		element.numbers.style.fontSize = size+type;	},	});Event.observe(window, 'load', function(){    zeta.extendedtextarea.init();});